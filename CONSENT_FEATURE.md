# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ–≥–ª–∞—Å–∏—è —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Telegram Web App.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã Web App

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/presentation/web_app/`

- `privacy_policy.html` - HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
- `style.css` - –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—á–µ—Ä–Ω–æ-–±–µ–ª—ã–π –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω)

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞:** `users`

- `id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `username` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
- `consent_given_at` - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø—Ä–∏–Ω—è—Ç–∏—è —Å–æ–≥–ª–∞—Å–∏—è
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `alembic/versions/002_add_users_table.py`

### 3. Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≥–ª–∞—Å–∏—è

**–§–∞–π–ª:** `src/infrastructure/telegram_bot/consent_middleware.py`

–§—É–Ω–∫—Ü–∏–∏:
- `check_consent()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–æ–≥–ª–∞—Å–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- `show_consent_message()` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ Web App –∏ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
- `handle_consent_acceptance()` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç–∏–µ —Å–æ–≥–ª–∞—Å–∏—è
- `show_welcome_message()` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–∏—è

### 4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞

**–û–±–Ω–æ–≤–ª–µ–Ω:** `src/infrastructure/telegram_bot/handlers.py`

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–∏—è –≤ `start()` –∏ `handle_phone()`
- –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –¥–ª—è –∫–Ω–æ–ø–∫–∏ "‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"

### 5. FastAPI —Å—Ç–∞—Ç–∏–∫–∞

**–û–±–Ω–æ–≤–ª–µ–Ω:** `src/presentation/bot/main.py`

- –î–æ–±–∞–≤–ª–µ–Ω mount –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤: `/webapp`

## –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–æ–≥–ª–∞—Å–∏—è –≤ –ë–î
3. –ï—Å–ª–∏ —Å–æ–≥–ª–∞—Å–∏—è –Ω–µ—Ç:
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏:
     - "üìÑ –û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π" (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Web App)
     - "‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ)
4. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å":
   - –°–æ–∑–¥–∞–µ—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `consent_given_at`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. –ü—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö —Å–æ–≥–ª–∞—Å–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í `.env` —Ñ–∞–π–ª–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–∫–∞–∑–∞–Ω `WEBHOOK_URL` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã Web App:

```env
WEBHOOK_URL=https://your-domain.com
```

–ï—Å–ª–∏ `WEBHOOK_URL` –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `http://localhost:8000` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
docker-compose exec app alembic upgrade head
```

–ò–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
3. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å–æ–≥–ª–∞—Å–∏–µ–º
4. –ù–∞–∂–º–∏—Ç–µ "üìÑ –û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π" - –æ—Ç–∫—Ä–æ–µ—Ç—Å—è Web App
5. –ù–∞–∂–º–∏—Ç–µ "‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" - —Å–æ–≥–ª–∞—Å–∏–µ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
6. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º `/start` —Å–æ–≥–ª–∞—Å–∏–µ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–§–∞–∫—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è = —Å–æ–≥–ª–∞—Å–∏–µ**: –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –°–æ–≥–ª–∞—Å–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º
- **Web App**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω**: –ß–µ—Ä–Ω–æ-–±–µ–ª–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ URL

- Web App: `https://your-domain.com/webapp/privacy_policy.html`
- CSS: `https://your-domain.com/webapp/style.css`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –°–æ–≥–ª–∞—Å–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- Web App —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ HTTPS (–≤ production)

